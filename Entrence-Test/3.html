<!-- write a program to calculate expenses for individuals in a trip which given by more than one person for different tickets and common expenses. output should have total trip expense, sum of individuals expense, whom you have to pay and how much you have to pay. -->

<html>

<head>
    <title>Answer 3</title>
</head>

<body bgcolor="#aaa">
    <div id="person-container">
        <div id="add_person"></div>
    </div>
    <button onclick="add_person()">Add Person</button>
</body>

<script>

    class TripMember {
        constructor(name, tickets, common_expenses) {
            this.name = name;
            this.tickets = tickets;
            this.commonExpenses = common_expenses;
        }

        get totalExpense() {
            let sum = this.tickets.reduce((acc, val) => acc + Number(val), 0);
            return sum + this.commonExpenses;
        }

        toString() {
            return `${this.name} spent a total of ${this.totalExpense.toFixed(2)} dollars on the trip`;
        }
    }

const participants = [
    { name: "Alice", tickets: [50, 80, 25], commonExpenses: 50 },
    { name: "Bob", tickets: [35, 40], commonExpenses: 25 },
    { name: "Charlie", tickets: [60, 90, 100], commonExpenses: 40 }
];

const calculate = () => {

    let total_expenses = 0
    let individual_expenses = {}

    for (let individual of participants) {

        if (individual.commonExpenses) {
            total_expenses += parseFloat(individual.commonExpenses)
            individual_expenses[individual.name] = parseFloat(individual.commonExpenses)
        }
        if (individual.tickets)
            for (let cost of individual.tickets) {
                total_expenses += parseFloat(cost)
                individual_expenses[individual.name] += parseFloat(cost)
            }
    }

    const average_expenses = parseInt(total_expenses / participants.length);

    let abcd = {}
    for (let individual of participants) {
        abcd[individual.name] = average_expenses - individual_expenses[individual.name]
    }

    return [total_expenses, individual_expenses, abcd]
}

let [total_expenses, individual_expenses, abcd] = calculate()
console.log(total_expenses);
console.log(individual_expenses);
console.log(abcd);

for (let individual in abcd) {
    if (abcd[individual] > 0)
        console.log(`You have to take ${individual}'s ${Math.abs(abcd[individual])}$`);
    else if (abcd[individual] < 0)
        console.log(`You have to pay ${individual} ${Math.abs(abcd[individual])}$`);
}


    let person_json = {}



    const change_tickets = (id, value, index) => {
        console.log(id + " " + value + " " + index);
        person_json[id] = { ...person_json[id], ...{ index } }
    }

    const change_name = (id, value) => {
        person_json[id] = { ...person_json[id], ...{ name: value } }
    }

    const change_common_expenses = (id, value) => {
        person_json[id] = { ...person_json[id], ...{ common_expenses: value } }
        console.log(person_json);
    }


    const add_person = () => {
        const id = document.querySelectorAll(".person").length + 1
        const person_component = `
        <fieldset class="person">
            <legend>Person ${id}</legend>
            <table id="p-${id}" border="1">
                <tr id="p-${id}-tr-name">
                    <td>Name : </td>
                    <td>
                        <input type="text" oninput="change_name('p-${id}', this.value)" id="p-${id}-name" required>
                    </td>
                </tr>
                <tr id="p-${id}-tr-tickets"> 
                    <td colspan="2">Tickets</td> 
                </tr> 
                <tr id="p-${id}-add-ticket">
                    <td><button onclick="add_ticket('p-${id}')">Add Ticket</button></td>
                    <td><button onclick="remove_last_ticket('p-${id}')">Remove last</button></td>
                </tr>
                <tr id="p-${id}-tr-common-expenses">
                    <td colspan="2"><button onclick="add_common_expenses('p-${id}')">Add common expenses</button></td>
                </tr>
            </table>
        </fieldset>
        <div id="add_person"></div>
            `
        document.getElementById("add_person").outerHTML = person_component

    }

    const add_ticket = (id) => {
        let tickets = document.querySelectorAll(`.${id}-tr-tickets`);
        const s1 = `<tr class="${id}-tr-tickets"><td> Ticket ${tickets.length + 1} : </td><td><input type="text"  oninput="change_tickets('${id}',this.value, '${tickets.length}')"  class="${id}-t"></td> </tr>`
        console.log(tickets[tickets.length - 1]);
        let temp_data = document.getElementById(`${id}-add-ticket`).outerHTML
        document.getElementById(`${id}-add-ticket`).outerHTML = s1 + temp_data
    }

    const remove_last_ticket = (id) => {
        let elements = document.querySelectorAll(`.${id}-tr-tickets`)
        if (elements.length == 0) return
        elements[elements.length - 1].remove()
    }

    const add_common_expenses = (id) => {
        console.log(id + "-tr-common-expenses");
        console.log(document.getElementById(id + "-tr-common-expenses"));
        const s1 = ` <td>Common expenses : </td> <td><input oninput = "change_common_expenses('${id}', this.value)"/></td> `
        document.getElementById(id + "-tr-common-expenses").innerHTML = s1

    }


</script>

</html>